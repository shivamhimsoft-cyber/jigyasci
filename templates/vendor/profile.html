{% extends "base.html" %}
{% block title %}Vendor Profile{% endblock %}

{% block content %}
<div class="bg-gray-50 dark:bg-gray-900 min-h-screen py-8">
  <div class="container full-container max-w-full mx-auto px-4 sm:px-6 lg:px-8">
    <div class="grid grid-cols-12 gap-6">
      <div class="col-span-12">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 p-8">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h5 class="text-2xl font-bold mb-1" style="color: #66C0DC;">Vendor Profile</h5>
              <p class="text-gray-600 dark:text-gray-400">Add or update your vendor profile below.</p>
            </div>
            <button type="button" id="edit-btn" class="px-6 py-3 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 hover:bg-blue-700 text-white shadow-sm transition-all duration-200 transform hover:scale-105">
              <i class="ti ti-edit mr-2"></i>Edit Profile
            </button>
          </div>

          <!-- Form -->
          <form id="profile-form" method="POST" enctype="multipart/form-data" class="grid grid-cols-1 lg:grid-cols-12 gap-6 mt-4">
            <!-- Profile Picture (Logo) Section -->
            <div class="col-span-12 mb-6">
              <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Company Logo (Profile Picture)</label>
              <div class="flex items-start space-x-6">
                <div class="flex-shrink-0">
                  {% if vendor and vendor.logo %}
                    <img src="{{ url_for('static', filename=vendor.logo) }}" alt="Current Company Logo" class="w-20 h-20 rounded-full object-cover border-2 border-gray-200 shadow-sm">
                  {% else %}
                    <div class="w-20 h-20 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center border-2 border-dashed border-gray-300 dark:border-gray-600 shadow-sm">
                      <i class="ti ti-building text-gray-400 dark:text-gray-500 text-xl"></i>
                    </div>
                  {% endif %}
                </div>
                <div class="flex-1">
                  <label for="logo" class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 cursor-pointer transition-all duration-200">
                    <i class="ti ti-upload mr-2 text-indigo-500"></i>Choose New Logo
                  </label>
                  <input type="file" id="logo" name="logo" class="sr-only" accept="image/*">
                  <small class="text-gray-500 dark:text-gray-400 block mt-1">Upload a new image to replace the current one (optional, max 2MB, JPG/PNG)</small>
                </div>
              </div>
            </div>

            <!-- Left Column -->
            <div class="lg:col-span-6 col-span-12">
              <div class="space-y-6">
                <div class="form-group">
                  <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Company Name</label>
                  <input name="company_name" value="{{ vendor.company_name if vendor else '' }}" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-gray-600 dark:text-gray-400" readonly>
                </div>
                <div class="form-group">
                  <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Contact Person</label>
                  <input name="contact_person" value="{{ vendor.contact_person if vendor else '' }}" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-gray-600 dark:text-gray-400" readonly>
                </div>
                <div class="form-group">
                  <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Email</label>
                  <input type="email" name="email" value="{{ vendor.email if vendor else '' }}" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-gray-600 dark:text-gray-400" readonly>
                </div>
                <div class="form-group">
                  <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Phone Number</label>
                  <input name="contact_phone" value="{{ vendor.contact_phone if vendor else '' }}" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-gray-600 dark:text-gray-400" readonly>
                </div>
                <div class="form-group">
                  <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">GST</label>
                  <input name="gst" value="{{ vendor.gst if vendor else '' }}" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-gray-600 dark:text-gray-400" readonly>
                </div>
                <div class="form-group">
                  <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">PAN</label>
                  <input name="pan" value="{{ vendor.pan if vendor else '' }}" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-gray-600 dark:text-gray-400" readonly>
                </div>
              </div>
            </div>

            <!-- Right Column -->
            <div class="lg:col-span-6 col-span-12">
              <div class="space-y-6">
                <div class="form-group">
                  <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Address</label>
                  <input name="address" value="{{ vendor.address if vendor else '' }}" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-gray-600 dark:text-gray-400" readonly>
                </div>
                <div class="form-group">
                  <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Region</label>
                  <input name="region" value="{{ vendor.region if vendor else '' }}" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-gray-600 dark:text-gray-400" readonly>
                </div>
                <div class="form-group">
                  <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Dealing Categories</label>
                  <select name="dealing_categories" multiple class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-gray-600 dark:text-gray-400" disabled>
                    {% for category in dealing_categories %}
                      <option value="{{ category.name }}" {% if vendor and category.name in vendor.dealing_categories.split(', ') %}selected{% endif %}>{{ category.name }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
            </div>

            <!-- Full Width Sections -->
            <div class="col-span-12">
              <div class="form-group">
                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Product Categories</label>
                <textarea name="product_categories" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-gray-600 dark:text-gray-400" rows="2" readonly>{{ vendor.product_categories if vendor else '' }}</textarea>
              </div>
            </div>

            <div class="col-span-12">
              <div class="form-group">
                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Why Choose Us</label>
                <textarea name="why_me" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-gray-600 dark:text-gray-400" rows="3" readonly>{{ vendor.why_me if vendor else '' }}</textarea>
              </div>
            </div>

            <div class="col-span-12">
              <div class="form-group">
                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Regional Contacts (comma-separated)</label>
                <input name="regional_contacts" value="{{ vendor.regional_contacts if vendor else '' }}" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-gray-600 dark:text-gray-400" readonly placeholder="e.g., North: John Doe, South: Jane Smith">
              </div>
            </div>

            <div class="col-span-12">
              <div class="form-group">
                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Proud Customers</label>
                <textarea name="proud_customers" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-gray-600 dark:text-gray-400" rows="3" readonly>{{ vendor.proud_customers if vendor else '' }}</textarea>
              </div>
            </div>

            <div class="col-span-12 mb-6">
              <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Document Upload</label>
              <div class="flex items-start space-x-6">
                <div class="flex-shrink-0">
                  {% if vendor and vendor.document_upload %}
                    <a href="{{ url_for('static', filename=vendor.document_upload) }}" target="_blank" class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 cursor-pointer transition-all duration-200">
                      <i class="ti ti-file-text mr-2 text-indigo-500"></i>View Document
                    </a>
                  {% else %}
                    <div class="w-20 h-20 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center border-2 border-dashed border-gray-300 dark:border-gray-600 shadow-sm">
                      <i class="ti ti-file text-gray-400 dark:text-gray-500 text-xl"></i>
                    </div>
                  {% endif %}
                </div>
                <div class="flex-1">
                  <label for="document_upload" class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 cursor-pointer transition-all duration-200">
                    <i class="ti ti-upload mr-2 text-indigo-500"></i>Choose Document
                  </label>
                  <input type="file" id="document_upload" name="document_upload" class="sr-only" accept=".pdf,.doc,.docx">
                  <small class="text-gray-500 dark:text-gray-400 block mt-1">Upload document (optional, max 5MB, PDF/DOC/DOCX)</small>
                </div>
              </div>
            </div>

            <!-- Buttons -->
            <div class="col-span-12 flex justify-end mt-6 gap-3 pt-4 border-t border-gray-200 dark:border-gray-700">
              <button type="button" id="cancel-btn" class="px-6 py-3 text-sm font-semibold rounded-lg border border-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 shadow-sm transition-all duration-200 transform hover:scale-105" style="display: none;">
                <i class="ti ti-x mr-2"></i>Cancel
              </button>
              <button type="submit" id="update-btn" disabled class="px-6 py-3 text-sm font-semibold rounded-lg border border-transparent bg-green-600 hover:bg-green-700 text-white shadow-sm transition-all duration-200 transform hover:scale-105 opacity-50 cursor-not-allowed" style="display: none;">
                <i class="ti ti-check mr-2"></i>Update Profile
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('profile-form');
        const editBtn = document.getElementById('edit-btn');
        const cancelBtn = document.getElementById('cancel-btn');
        const updateBtn = document.getElementById('update-btn');

        // Store original values
        const originalValues = {};
        form.querySelectorAll('input, select, textarea').forEach(function(element) {
            if (element.type !== 'file') {
                originalValues[element.name] = element.value;
            }
        });

        // Function to enable editing
        function enableEditing() {
            form.querySelectorAll('input[readonly], select[disabled], textarea[readonly]').forEach(function(element) {
                if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                    element.removeAttribute('readonly');
                    element.classList.remove('text-gray-600', 'dark:text-gray-400');
                    element.classList.add('text-black', 'dark:text-white');
                } else if (element.tagName === 'SELECT') {
                    element.removeAttribute('disabled');
                    element.classList.remove('text-gray-600', 'dark:text-gray-400');
                    element.classList.add('text-black', 'dark:text-white');
                }
            });
            // Add focus styles for editable fields
            form.querySelectorAll('input:not([readonly]), select:not([disabled]), textarea:not([readonly])').forEach(function(element) {
                element.classList.add('focus:ring-2', 'focus:ring-indigo-500', 'focus:border-transparent');
            });
            editBtn.style.display = 'none';
            cancelBtn.style.display = 'inline-block';
            updateBtn.style.display = 'inline-block';
            updateBtn.disabled = false;
            updateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        // Function to disable editing
        function disableEditing() {
            form.querySelectorAll('input, select, textarea').forEach(function(element) {
                if (element.type !== 'file' && element.name !== 'logo' && element.name !== 'document_upload') {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.setAttribute('readonly', true);
                        element.classList.remove('text-black', 'dark:text-white');
                        element.classList.add('text-gray-600', 'dark:text-gray-400');
                        element.blur();
                    } else if (element.tagName === 'SELECT') {
                        element.setAttribute('disabled', true);
                        element.classList.remove('text-black', 'dark:text-white');
                        element.classList.add('text-gray-600', 'dark:text-gray-400');
                    }
                }
            });
            editBtn.style.display = 'block';
            cancelBtn.style.display = 'none';
            updateBtn.style.display = 'none';
            updateBtn.disabled = true;
            updateBtn.classList.add('opacity-50', 'cursor-not-allowed');
        }

        // Function to reset form
        function resetForm() {
            form.querySelectorAll('input, select, textarea').forEach(function(element) {
                if (element.type !== 'file') {
                    element.value = originalValues[element.name] || '';
                } else {
                    element.value = ''; // Reset file input
                }
            });
            // Re-apply readonly/disabled after reset
            disableEditing();
        }

        // Edit button click
        editBtn.addEventListener('click', enableEditing);

        // Cancel button: reset form and disable editing
        cancelBtn.addEventListener('click', resetForm);
    });
</script>
{% endblock %}