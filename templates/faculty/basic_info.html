<!-- templates\faculty\basic_info.html -->

{% extends "base.html" %}
{% block title %}Basic Information{% endblock %}

{% block content %}
<div class="grid grid-cols-12 gap-6">
    <div class="col-span-12">
        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h5 class="text-2xl font-bold mb-1" style="color: #66C0DC;">Personal Details</h5>
                    <p class="text-gray-600">To change your personal detail, edit and save from here.</p>
                </div>
            </div>

            <!-- Form -->
            <form id="profile-form" method="POST" enctype="multipart/form-data" class="grid grid-cols-12 gap-x-6 gap-y-4">
                <!-- Profile Picture at Top -->
                <div class="col-span-12">
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Profile Picture</label>
                        <div class="flex items-start space-x-4 mb-3">
                            <div class="flex-shrink-0">
                                {% if profile and profile.profile_picture %}
                                    <img src="{{ url_for('static', filename='Uploads/' + profile.profile_picture) }}" alt="Current Profile Picture" class="w-20 h-20 rounded-full object-cover border-2 border-gray-200 shadow-sm">
                                {% else %}
                                    <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center border-2 border-dashed border-gray-300 shadow-sm">
                                        <i class="ti ti-user text-gray-400 text-xl"></i>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="flex-1">
                                <label for="profile_picture" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 cursor-pointer transition-all duration-200">
                                    <i class="ti ti-upload mr-2 text-indigo-500"></i>Choose New Photo
                                </label>
                                <input type="file" id="profile_picture" name="profile_picture" class="sr-only" accept="image/*">
                                <small class="text-gray-500 block mt-1">Upload a new image to replace the current one (optional, max 2MB, JPG/PNG)</small>
                            </div>
                        </div>
                    </div>
                </div>



            <!-- Form -->
            <form id="profile-form" method="POST" enctype="multipart/form-data" class="grid grid-cols-12 gap-x-6 gap-y-4">
                <!-- Left Column -->
                <div class="lg:col-span-6 col-span-12">
                    <div class="space-y-4">
                        <div class="form-group">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Full Name</label>
                            <input name="name" value="{{ profile.name if profile else '' }}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" placeholder="Enter full name" readonly>
                        </div>
                        <div class="form-group">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Department</label>
                            <select name="department" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" disabled>
                                <option value="">Select Department</option>
                                {% for dept in departments %}
                                <option value="{{ dept.name }}" {% if profile and profile.department == dept.name %}selected{% endif %}>{{ dept.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Affiliation</label>
                            <input name="affiliation" value="{{ profile.affiliation if profile else '' }}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" placeholder="Enter affiliation" readonly>
                        </div>
                        <div class="form-group">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Gender</label>
                            <select name="gender" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" disabled>
                                <option value="">Select Gender</option>
                                {% for gender in genders %}
                                <option value="{{ gender.name }}" {% if profile and profile.gender == gender.name %}selected{% endif %}>{{ gender.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="lg:col-span-6 col-span-12">
                    <div class="space-y-4">
                        <div class="form-group">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Designation</label>
                            <select name="current_designation" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" disabled>
                                <option value="">Select Designation</option>
                                {% for designation in designations %}
                                <option value="{{ designation.name }}" {% if profile and profile.current_designation == designation.name %}selected{% endif %}>{{ designation.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Start Date</label>
                            <input type="date" name="start_date" value="{{ profile.start_date.strftime('%Y-%m-%d') if profile and profile.start_date else '' }}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" readonly>
                        </div>
                        <div class="form-group">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Date of Birth</label>
                            <input type="date" name="dob" value="{{ profile.dob.strftime('%Y-%m-%d') if profile and profile.dob else '' }}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" readonly>
                        </div>
                        <div class="form-group">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Email</label>
                            <input type="email" name="email" value="{{ profile.email if profile else '' }}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" placeholder="Enter email" readonly>
                        </div>
                    </div>
                </div>

                <!-- Full Width Sections -->
                <div class="col-span-12">
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Phone Number</label>
                        <input name="contact_phone" value="{{ profile.contact_phone if profile else '' }}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" placeholder="Enter phone number" readonly>
                    </div>
                </div>

                <div class="col-span-12">
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Address</label>
                        <input name="address" value="{{ profile.address if profile else '' }}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" placeholder="Enter address" readonly>
                    </div>
                </div>

                <div class="col-span-12">
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Profile URL</label>
                        <input name="profile_url" value="{{ profile.profile_url if profile else '' }}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" placeholder="Enter profile URL" readonly>
                    </div>
                </div>

                <div class="col-span-12">
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Affiliation (Short)</label>
                        <input name="affiliation_short" value="{{ profile.affiliation_short if profile else '' }}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" placeholder="Enter short affiliation" readonly>
                    </div>
                </div>

                <div class="col-span-12">
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Location (City)</label>
                        <input name="location" value="{{ profile.location if profile else '' }}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" placeholder="Enter location" readonly>
                    </div>
                </div>

                <div class="col-span-12">
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Education Summary</label>
                        <textarea name="education_summary" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" rows="4" readonly>{{ profile.education_summary if profile else '' }}</textarea>
                    </div>
                </div>

                <div class="col-span-12">
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Research Interest</label>
                        <textarea name="research_interest" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" rows="4" readonly>{{ profile.research_interest if profile else '' }}</textarea>
                    </div>
                </div>

                                <!-- Research Profiles -->
                <div class="col-span-12">
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Research Profiles</label>
                        <select name="research_profiles" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" disabled>
                            <option value="">Select Research Profile</option>
                            {% for rp in research_profiles %}
                            <option value="{{ rp.name }}" {% if profile and profile.research_profiles == rp.name %}selected{% endif %}>{{ rp.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="col-span-12 lg:col-span-6">
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Papers Published</label>
                        <input type="number" name="papers_published" value="{{ profile.papers_published if profile else '' }}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" readonly>
                    </div>
                </div>

                <div class="col-span-12 lg:col-span-6">
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Total Citations</label>
                        <input type="number" name="total_citations" value="{{ profile.total_citations if profile else '' }}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" readonly>
                    </div>
                </div>

                <div class="col-span-12 lg:col-span-6">
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Research Experience (Years)</label>
                        <input type="number" name="research_experience_years" value="{{ profile.research_experience_years if profile else '' }}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" readonly>
                    </div>
                </div>

                <div class="col-span-12 lg:col-span-6">
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">H-Index</label>
                        <input type="number" name="h_index" value="{{ profile.h_index if profile else '' }}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" readonly>
                    </div>
                </div>

                <div class="col-span-12">
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Current Message</label>
                        <textarea name="current_message" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" rows="4" readonly>{{ profile.current_message if profile else '' }}</textarea>
                    </div>
                </div>

                <div class="col-span-12">
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Current Focus (Research Area)</label>
                        <select name="current_focus" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" disabled>
                            <option value="">Select Research Area</option>
                            {% for area in research_areas %}
                            <option value="{{ area.name }}" {% if profile and profile.current_focus == area.name %}selected{% endif %}>{{ area.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="col-span-12">
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Expectations from Students</label>
                        <textarea name="expectations" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" rows="4" readonly>{{ profile.expectations_from_students if profile else '' }}</textarea>
                    </div>
                </div>

                <div class="col-span-12">
                    <div class="form-group">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Why Join Lab</label>
                        <textarea name="why_join_lab" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-black" rows="4" readonly>{{ profile.why_join_lab if profile else '' }}</textarea>
                    </div>
                </div>

                

                <!-- Buttons -->
                <div class="col-span-12 flex justify-end mt-6 gap-3 pt-4 border-t border-gray-200">
                    <button type="button" id="edit-btn" class="px-6 py-3 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 hover:bg-blue-700 text-white shadow-sm transition-all duration-200 transform hover:scale-105">
                        <i class="ti ti-edit mr-2"></i>Edit Profile
                    </button>
                    <button type="button" id="cancel-btn" class="px-6 py-3 text-sm font-semibold rounded-lg border border-gray-300 bg-gray-100 hover:bg-gray-200 text-gray-700 shadow-sm transition-all duration-200 transform hover:scale-105" style="display: none;">
                        <i class="ti ti-x mr-2"></i>Cancel
                    </button>
                    <button type="submit" id="update-btn" disabled class="px-6 py-3 text-sm font-semibold rounded-lg border border-transparent bg-green-600 hover:bg-green-700 text-white shadow-sm transition-all duration-200 transform hover:scale-105 opacity-50 cursor-not-allowed" style="display: none;">
                        <i class="ti ti-check mr-2"></i>Update Profile
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('profile-form');
        const editBtn = document.getElementById('edit-btn');
        const cancelBtn = document.getElementById('cancel-btn');
        const updateBtn = document.getElementById('update-btn');

        // Store original values
        const originalValues = {};
        form.querySelectorAll('input, select, textarea').forEach(function(element) {
            if (element.type !== 'file') {
                originalValues[element.name] = element.value;
            }
        });

        // Function to enable editing
        function enableEditing() {
            form.querySelectorAll('input[readonly], select[disabled], textarea[readonly]').forEach(function(element) {
                if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                    element.removeAttribute('readonly');
                    element.classList.add('bg-white', 'text-black');
                } else if (element.tagName === 'SELECT') {
                    element.removeAttribute('disabled');
                    element.classList.add('text-black');
                }
            });
            // Add focus styles for editable fields
            form.querySelectorAll('input:not([readonly]), select:not([disabled]), textarea:not([readonly])').forEach(function(element) {
                element.classList.add('focus:ring-2', 'focus:ring-indigo-500', 'focus:border-transparent');
            });
            editBtn.style.display = 'none';
            cancelBtn.style.display = 'inline-block';
            updateBtn.style.display = 'inline-block';
            updateBtn.disabled = false;
            updateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        // Function to disable editing
        function disableEditing() {
            form.querySelectorAll('input, select, textarea').forEach(function(element) {
                if (element.type !== 'file') {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.setAttribute('readonly', true);
                        element.classList.remove('bg-white', 'text-black');
                        element.blur();
                    } else if (element.tagName === 'SELECT') {
                        element.setAttribute('disabled', true);
                        element.classList.remove('text-black');
                    }
                }
            });
            editBtn.style.display = 'inline-block';
            cancelBtn.style.display = 'none';
            updateBtn.style.display = 'none';
            updateBtn.disabled = true;
            updateBtn.classList.add('opacity-50', 'cursor-not-allowed');
        }

        // Function to reset form
        function resetForm() {
            form.querySelectorAll('input, select, textarea').forEach(function(element) {
                if (element.type !== 'file') {
                    element.value = originalValues[element.name] || '';
                } else {
                    element.value = ''; // Reset file input
                }
            });
            // Re-apply readonly/disabled after reset
            disableEditing();
        }

        // Edit button click
        editBtn.addEventListener('click', enableEditing);

        // Cancel button: reset form and disable editing
        cancelBtn.addEventListener('click', resetForm);
    });
</script>
{% endblock %}