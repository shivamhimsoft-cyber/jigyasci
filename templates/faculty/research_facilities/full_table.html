<!-- templates\faculty\research_facilities\full_table.html -->

{% extends "frontBase.html" %}
{% block title %}Research Facilities | Full Table{% endblock %}

{% block navbar_extra_profile %}
<div><img src="../static/images/logo-shade_blue.png" class="lg:h-[60px] md:h-[60px] h-[50px] w-auto " alt=""></div>
{% endblock %}
{% block nav_bar_width %}
    w-full py-2
{% endblock %}
{% block footer_width %}
    w-full
{% endblock %}

{% block navbar_extra %}
<form action="{{ url_for('facility.full_table') }}" method="GET" class="flex flex-grow max-w-md w-full">
    <div class="relative w-full">
        <input type="text" name="query" value="{{ query or '' }}" placeholder="Search Equipment / PI / Institute"
               class="w-full pr-10 px-0 text-secondary border-b-[1px] border-b-secondary/60 border-0 py-0 focus:ring-0 focus:outline-none focus:border-secondary" />
        <button type="submit" class="absolute right-3 top-[50%] translate-y-[-50%] text-secondary hover:scale-105 transition ease-in duration-2000">
            <i class="fa fa-search"></i>
        </button>
    </div>
</form>
{% endblock %}

{% block content %}
<div class=" w-full  mx-auto px-4 ">
    <div class="w-full flex justify-center">
        <h1 class="lg:text-3xl md:text-2xl sm:text-xl text-xl font-bold text-secondary mb-6">Research Facilities - Full View</h1>
    </div>

    <!-- Add filters if needed -->
    <form action="{{ url_for('facility.full_table') }}" method="GET" class="flex flex-wrap justify-end gap-2 mb-4">
        <h2 class="sr-only">Filter Facilities</h2>

        <!-- Example filter - customize based on your needs -->
        <select name="status" class="py-1 px-3 rounded-sm border border-secondary/30 focus:border-secondary bg-gray-100 text-secondary w-[165px] flex-shrink-0 focus:ring-0 focus:outline-none">
            <option value="">All Statuses</option>
            <option value="working" {% if status == 'working' %}selected{% endif %}>Working</option>
            <option value="maintenance" {% if status == 'maintenance' %}selected{% endif %}>Maintenance</option>
            <option value="out_of_service" {% if status == 'out_of_service' %}selected{% endif %}>Out of Service</option>
        </select>

        <button type="submit" class="px-6 py-1 bg-secondary/90 text-white border-secondary border-[1px] rounded-sm hover:bg-secondary transition ease-in duration-2000">
            Filter
        </button>
    </form>

    <div class="overflow-x-auto shadow-md">
        <table class="w-full bg-white border border-gray-200">
            <thead class="">
                <tr class="w-full bg-white border border-gray-200 ">
                    <th class="px-4 py-2 text-white  border-[1px] border-white-gray-100 border-b-black text-[16px] whitespace-nowrap font-normal ">#</th>
                    <th class="px-4 py-2 text-white  border-[1px] border-white-gray-100 border-b-black text-[16px] whitespace-nowrap font-normal ">
                        <a href="{{ url_for('facility.full_table', query=query, sort='pi', direction='asc' if sort != 'pi' or direction == 'desc' else 'desc', page=page) }}" class="hover:underline flex items-center">
                            PI
                            {% if sort == 'pi' %}
                                <span class="ml-2 inline-block w-4">{% if direction == 'asc' %}↑{% else %}↓{% endif %}</span>
                            {% endif %}
                        </a>
                    </th>
                    <th class="px-4 py-2 text-white  border-[1px] border-white-gray-100 border-b-black text-[16px] whitespace-nowrap font-normal ">
                        <a href="{{ url_for('facility.full_table', query=query, sort='equipment_name', direction='asc' if sort != 'equipment_name' or direction == 'desc' else 'desc', page=page) }}" class="hover:underline flex items-center">
                            Equipment
                            {% if sort == 'equipment_name' %}
                                <span class="ml-2 inline-block w-4">{% if direction == 'asc' %}↑{% else %}↓{% endif %}</span>
                            {% endif %}
                        </a>
                    </th>
                    <th class="px-4 py-2 text-white  border-[1px] border-white-gray-100 border-b-black text-[16px] whitespace-nowrap font-normal ">
                        <a href="{{ url_for('facility.full_table', query=query, sort='make', direction='asc' if sort != 'make' or direction == 'desc' else 'desc', page=page) }}" class="hover:underline flex items-center">
                            Make/Model
                            {% if sort == 'make' %}
                                <span class="ml-2 inline-block w-4">{% if direction == 'asc' %}↑{% else %}↓{% endif %}</span>
                            {% endif %}
                        </a>
                    </th>
                    <th class="px-4 py-2 text-white  border-[1px] border-white-gray-100 border-b-black text-[16px] whitespace-nowrap font-normal ">
                        <a href="{{ url_for('facility.full_table', query=query, sort='working_status', direction='asc' if sort != 'working_status' or direction == 'desc' else 'desc', page=page) }}" class="hover:underline flex items-center">
                            Status
                            {% if sort == 'working_status' %}
                                <span class="ml-2 inline-block w-4">{% if direction == 'asc' %}↑{% else %}↓{% endif %}</span>
                            {% endif %}
                        </a>
                    </th>
                    <th class="px-4 py-2 text-white  border-[1px] border-white-gray-100 border-b-black text-[16px] whitespace-nowrap font-normal ">
                        <a href="{{ url_for('facility.full_table', query=query, sort='institute', direction='asc' if sort != 'institute' or direction == 'desc' else 'desc', page=page) }}" class="hover:underline flex items-center">
                            Institute
                            {% if sort == 'institute' %}
                                <span class="ml-2 inline-block w-4">{% if direction == 'asc' %}↑{% else %}↓{% endif %}</span>
                            {% endif %}
                        </a>
                    </th>
                    <!-- <th class="px-4 py-2 text-white border-[1px] border-white-gray-100 text-[19px] whitespace-nowrap">Action</th> -->
                </tr>
            </thead>

            <tbody class="divide-y divide-gray-200">
                {% for facility in facilities.items %}
                <tr class="{% if loop.index0 % 2 == 0 %}bg-white{% else %}bg-primary/10{% endif %} hover:bg-primary/30">
                    <td class="px-4 py-2 border-[1px] border-black  max-w-[200px] overflow-x-auto font-medium text-[17px]">{{ (facilities.page - 1) * facilities.per_page + loop.index }}</td>
                    <td class="px-4 py-2 border-[1px] border-black  max-w-[200px] overflow-x-auto font-medium text-[17px]">
                        <div class="flex gap-2 items-center">
                            <div class="h-10 w-10 flex-none rounded-full border-[1px] border-secondary/30">
                                <img src="{{ facility.pi.profile_image_url if facility.pi.profile_image_url else url_for('static', filename='images/profile.png') }}"
                                     onerror="this.onerror=null;this.src='{{ url_for('static', filename='images/logo-shade_blue.png') }}';"
                                     class="h-full w-full object-cover rounded-full">
                            </div>
                            <a href="{{ url_for('faculty_info', profile_id=facility.pi.profile.id) }}"
                               class="text-blue-600 hover:underline">
                                {{ facility.pi.name }}
                            </a>
                        </div>
                    </td>
                    <td class="px-4 py-2 border-[1px] border-black  max-w-[200px] overflow-x-auto font-medium text-[17px]">{{ facility.equipment_name }}</td>
                    <td class="px-4 py-2 border-[1px] border-black  max-w-[200px] overflow-x-auto font-medium text-[17px]">{{ facility.make }} {{ facility.model }}</td>
                    <td class="px-4 py-2 border-[1px] border-black  max-w-[200px] overflow-x-auto font-medium text-[17px]">
                        <span class="px-2 py-1 rounded-full text-sm
                            {% if facility.working_status == 'working' %}bg-green-100 text-green-800
                            {% elif facility.working_status == 'maintenance' %}bg-yellow-100 text-yellow-800
                            {% else %}bg-red-100 text-red-800{% endif %}">
                            {{ facility.working_status|replace('_', ' ')|title }}
                        </span>
                    </td>
                    <td class="px-4 py-2 border-[1px] border-black  max-w-[200px] overflow-x-auto font-medium text-[17px]">{{ facility.pi.affiliation_short }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% if facilities.pages > 1 %}
    <div class="mt-6 flex justify-center">
        <nav class="inline-flex rounded-md shadow">
            {% if facilities.has_prev %}
            <a href="{{ url_for('facility.full_table',
                              page=facilities.prev_num,
                              query=query,
                              sort=sort,
                              direction=direction,
                              status=status) }}"
               class="px-3 py-2 rounded-l-md border border-gray-300 bg-white text-[19px] whitespace-nowrap font-medium text-gray-700 hover:bg-gray-50">Previous</a>
            {% endif %}

            {% for page_num in facilities.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=3) %}
                {% if page_num %}
                    {% if facilities.page == page_num %}
                    <a href="#" class="px-3 py-2 border-t border-b border-primary bg-primary text-secondary text-[19px] whitespace-nowrap font-medium">{{ page_num }}</a>
                    {% else %}
                    <a href="{{ url_for('facility.full_table',
                                      page=page_num,
                                      query=query,
                                      sort=sort,
                                      direction=direction,
                                      status=status) }}"
                       class="px-3 py-2 border-t border-b border-gray-300 bg-white text-[19px] whitespace-nowrap font-medium text-gray-700 hover:bg-gray-50">{{ page_num }}</a>
                    {% endif %}
                {% else %}
                <span class="px-3 py-2 border-t border-b border-gray-300 bg-white text-[19px] whitespace-nowrap font-medium text-gray-700">...</span>
                {% endif %}
            {% endfor %}

            {% if facilities.has_next %}
            <a href="{{ url_for('facility.full_table',
                              page=facilities.next_num,
                              query=query,
                              sort=sort,
                              direction=direction,
                              status=status) }}"
               class="px-3 py-2 rounded-r-md border border-gray-300 bg-white text-[19px] whitespace-nowrap font-medium text-gray-700 hover:bg-gray-50">Next</a>
            {% endif %}
        </nav>
    </div>
    {% endif %}
</div>
{% endblock %}
