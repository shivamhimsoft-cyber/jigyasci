<!-- templates\authBase.html -->
<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-theme="Blue_Theme" class="light selected"
      data-layout="vertical" data-boxed-layout="boxed" data-card="shadow">

<head>
    <!-- Required meta tags -->
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Favicon icon-->
    <link rel="shortcut icon" type="image/png" href="../static/images/logo-shade_blue.png" />
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
          rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@2.44.0/tabler-icons.min.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Orienta&family=Public+Sans:ital,wght@0,100..900;1,100..900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../static/assets/css/theme.css" />
    <title>{% block title %}Research Collaboration Platform{% endblock %}</title>

    <!-- Core Css -->
    <link rel="stylesheet" href="../static/assets/css/theme.css" />
    <title>Spike TailwindCSS HTML Admin Template</title>
</head>

<body class="DEFAULT_THEME bg-lightprimary dark:bg-darkbody">
    <!-- Flash Messages Import & Render -->
    {% from 'macros/_flash_macros.html' import render_flash_messages %}
    {{ render_flash_messages() }}

<main>
    <div id="main-wrapper" class="flex ">
        <div class="flex justify-center overflow-hidden h-full w-full min-h-screen">
            <div class="auth-login container container-xl relative flex items-center justify-center px-7 rounded-none">
                <div class="relative z-[1] container">
                    <div class="card auth-login-wrapper ">
                        <div class="card-body">
                            <div class="md:flex justify-around py-8 items-center">
                                <div class="lg:w-5/12 lg:flex hidden justify-center">
                                    <img src="../static/images/logo-shade_blue.png" alt="security" class="w-full h-fit">
                                </div>

<!--                                right side content section here-->
                                {% block content %}{% endblock %}
<!--                                right side content secton ends here-->
                            </div>
                        </div>
                        <!----Bottom Shape---->
                        <div class="absolute -bottom-24 -left-24 h-96 w-96 rounded-full bg-error -z-[1]"></div>
                        <!----Top Shape---->
                        <img src="../static/assets/images/shaps/shap-login.png" alt="shape" class="absolute h-80 w-80 -right-20 -z-[1] -top-24 ">
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Flash JS & CSS (Moved to end for reliable execution) -->
<script>
    // Global Flash Message Functions (now outside macro for better reliability)
    function showFlashMessage(category, message) {
        // Create container if not exists
        let flashContainer = document.getElementById('flash-messages');
        if (!flashContainer) {
            flashContainer = createFlashContainer();
        }
        
        // Clear all existing flash messages to prevent multiples
        const existingMessages = flashContainer.querySelectorAll('.flash-message');
        existingMessages.forEach(msg => {
            msg.classList.remove('animate-slide-in');
            msg.classList.add('animate-slide-out');
            setTimeout(() => msg.remove(), 300);
        });
        
        // Delay for animation
        setTimeout(() => {
            const flashDiv = document.createElement('div');
            flashDiv.className = `flash-message flex items-start p-4 rounded-lg shadow-lg border transition-all duration-300 transform animate-slide-in ${getFlashClasses(category)}`;
            flashDiv.innerHTML = `
                <div class="flex-shrink-0">
                    ${getFlashIcon(category)}
                </div>
                <div class="ml-3 flex-1">
                    <p class="text-sm font-medium">${message}</p>
                </div>
                <button type="button" class="ml-2 p-1 hover:bg-gray-200 rounded-full focus:outline-none" onclick="dismissMessage(event, this)">
                    <i class="ti ti-x text-lg"></i>
                </button>
            `;
            flashContainer.appendChild(flashDiv);
            
            // Auto-dismiss after 5 seconds (increased from 3 for visibility)
            setTimeout(() => dismissMessage(null, flashDiv.querySelector('button')), 5000);
        }, 350);
    }

    function createFlashContainer() {
        const container = document.createElement('div');
        container.id = 'flash-messages';
        container.className = 'fixed top-4 right-4 z-50 w-80 max-w-full space-y-3';
        document.body.insertBefore(container, document.body.firstChild);  // Insert at body start for overlay
        return container;
    }

    function getFlashClasses(category) {
        const classes = {
            success: 'bg-green-100 border-green-300 text-green-800',
            error: 'bg-red-100 border-red-300 text-red-800',
            warning: 'bg-yellow-100 border-yellow-300 text-yellow-800'
        };
        return classes[category] || 'bg-blue-100 border-blue-300 text-blue-800';
    }

    function getFlashIcon(category) {
        const icons = {
            success: '<i class="ti ti-check text-xl"></i>',
            error: '<i class="ti ti-alert-circle text-xl"></i>',
            warning: '<i class="ti ti-alert-triangle text-xl"></i>'
        };
        return icons[category] || '<i class="ti ti-info-circle text-xl"></i>';
    }

    // Fixed dismiss function (now handles event to prevent bubbling)
    function dismissMessage(event, button) {
        if (event) event.stopPropagation();  // Prevent any bubbling
        const message = button.closest('.flash-message');
        if (message) {
            message.classList.remove('animate-slide-in');
            message.classList.add('animate-slide-out');
            setTimeout(() => {
                message.remove();
                // If no messages left, optionally hide container
                const container = document.getElementById('flash-messages');
                if (container && container.children.length === 0) {
                    container.style.display = 'none';
                }
            }, 300);
        }
    }

    // Auto-dismiss for initial loaded messages (on DOM ready)
    document.addEventListener('DOMContentLoaded', () => {
        const messages = document.querySelectorAll('.flash-message');
        messages.forEach((message, index) => {
            // Staggered dismiss for multiple (5 + index*1 sec)
            setTimeout(() => {
                const closeBtn = message.querySelector('button');
                if (closeBtn) dismissMessage(null, closeBtn);
            }, 5000 + (index * 1000));
        });
        
        // Re-attach event listeners if needed (for dynamic buttons)
        document.addEventListener('click', (e) => {
            if (e.target.closest('button[onclick*="dismissMessage"]')) {
                const btn = e.target.closest('button');
                dismissMessage(e, btn);
            }
        });
    });
</script>

<style>
    .animate-slide-in { animation: slideIn 0.3s ease-out forwards; }
    .animate-slide-out { animation: slideOut 0.3s ease-in forwards; }
    @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
    .flash-message { 
        min-height: 3rem; 
        display: flex; 
        align-items: center; 
        padding: 1rem; 
        border-radius: 0.5rem; 
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); 
        position: relative;
    }
    .flash-message button:hover { 
        background-color: rgba(0, 0, 0, 0.1); 
    }
    #flash-messages { pointer-events: auto; }  /* Ensure clickable */
</style>

<script src="../static/assets/js/theme/app.init.js"></script>
<script src="../static/assets/js/theme/app.min.js"></script>
<script src="../static/assets/libs/simplebar/dist/simplebar.min.js"></script>
<script src="../static/assets/libs/iconify-icon/dist/iconify-icon.min.js"></script>
<script src="../static/assets/libs/preline/dist/preline.js"></script>
<script src="../static/assets/libs/_preline/input-number/index.js"></script>
<script src="https://bootstrapdemos.wrappixel.com/spike-tailwind/dist/assets/libs/_preline/tooltip/index.js"></script>
<script src="https://bootstrapdemos.wrappixel.com/spike-tailwind/dist/assets/libs/_preline/stepper/index.js"></script>

</body>
</html>