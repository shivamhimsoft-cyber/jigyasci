{% extends "frontBase.html" %}

{% block title %}Research Collaboration Platform | {{ vendor.company_name }}{% endblock %}

{% block navbar_extra_profile %}
<div><img src="{{ url_for('static', filename='images/logo-shade_blue.png') }}" class="lg:h-[60px] md:h-[60px] h-[50px] w-auto" alt=""></div>
{% endblock %}

{% block nav_bar_width %}
lg:w-[70%] md:w-[90%] w-full py-2
{% endblock %}
{% block footer_width %}
lg:w-[70%] md:w-[90%] w-full
{% endblock %}

{% block content %}
<style>
.bookmark-btn {
    transition: all 0.2s ease;
    z-index: 10;
}

.bookmark-btn.bookmarked i {
    color: #f59e0b !important; /* yellow-500 */
}

.bookmark-btn:hover {
    transform: scale(1.1);
}

/* Animation for bookmark icon */
@keyframes bounce {
    0%, 20%, 53%, 80%, 100% {
        transform: translate3d(0, 0, 0);
    }
    40%, 43% {
        transform: translate3d(0, -8px, 0);
    }
    70% {
        transform: translate3d(0, -4px, 0);
    }
    90% {
        transform: translate3d(0, -2px, 0);
    }
}

.bookmark-btn.bookmarked i {
    animation: bounce 0.5s;
}

/* Ensure bookmarked state is visible even without hover */
.bookmarked {
    opacity: 1 !important;
}
</style>

<div class="w-full flex justify-center p-4 min-h-screen">
    <div class="lg:w-[70%] md:w-[90%] w-full">
        <div class="p-4 flex lg:flex-row md:flex-row flex-col-reverse bg-white">
            <div class="w-full grid lg:grid-cols-4 md:grid-cols-3 grid-cols-1 gap-4">
                <!-- Left Sidebar with Tabs -->
                <div class="w-full">
                    <!-- Tab Navigation -->
                    <div class="bg-white sticky top-20">
                        <a href="#tab-content-vendorProfile">
                            <button class="vendor-tab-button w-full h-max text-left rounded-sm px-4 py-2 whitespace-nowrap bg-secondary text-white font-semibold hover:border-t-gray-100 hover:text-white hover:bg-secondary transition ease-in duration-2000">
                                <i class="fa fa-user text-sm mr-2"></i> Profile
                            </button>
                        </a>
                        <a href="#tab-content-message">
                            <button class="vendor-tab-button w-full h-max text-left rounded-sm px-4 py-2 whitespace-nowrap text-secondary font-semibold border-t-[1px] hover:border-t-gray-100 hover:text-white hover:bg-secondary transition ease-in duration-2000">
                                <i class="fa fa-envelope text-sm mr-2"></i> My Messages
                            </button>
                        </a>
                        <a href="#tab-content-orders">
                            <button class="vendor-tab-button w-full h-max text-left rounded-sm px-4 py-2 whitespace-nowrap text-secondary font-semibold border-t-[1px] hover:border-t-gray-100 hover:text-white hover:bg-secondary transition ease-in duration-2000">
                                <i class="fa fa-shopping-cart text-sm mr-2"></i> My Orders
                            </button>
                        </a>
                    </div>

                    <!-- Why Choose Us Section -->
                    {% if vendor.why_me %}
                    <div class="bg-white rounded-sm shadow-sm overflow-hidden mb-6 mt-6 border-[1px] border-gray-300">
                        <div class="bg-secondary px-3 py-2 text-white font-medium flex items-center">
                            <i class="fas fa-percentage mr-2"></i>
                            <span>Why Choose Us</span>
                        </div>
                        <div class="p-4">
                            <p class="text-gray-600 text-xs mb-2">{{ vendor.why_me }}</p>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Quick Contact Section -->
                    <div class="bg-white rounded-sm shadow-sm overflow-hidden mb-6 border-[1px] border-gray-300">
                        <div class="bg-secondary px-3 py-2 text-white font-medium flex items-center">
                            <i class="fas fa-comment-alt mr-2"></i>
                            <span>Quick Contact</span>
                        </div>
                        <div class="divide-y divide-gray-100">
                            {% if vendor.email %}
                            <div class="p-3">
                                <div class="flex justify-between">
                                    <h4 class="font-bold text-gray-800 text-sm mb-1">Email</h4>
                                </div>
                                <p class="text-gray-600 text-xs truncate">{{ vendor.email }}</p>
                            </div>
                            {% endif %}
                            {% if vendor.contact_phone %}
                            <div class="p-3">
                                <div class="flex justify-between">
                                    <h4 class="font-bold text-gray-800 text-sm mb-1">Phone</h4>
                                </div>
                                <p class="text-gray-600 text-xs truncate">{{ vendor.contact_phone }}</p>
                            </div>
                            {% endif %}
                            {% if vendor.address %}
                            <div class="p-3">
                                <div class="flex justify-between">
                                    <h4 class="font-bold text-gray-800 text-sm mb-1">Address</h4>
                                </div>
                                <p class="text-gray-600 text-xs truncate">{{ vendor.address }}</p>
                            </div>
                            {% endif %}
                            {% if not (vendor.email or vendor.contact_phone or vendor.address) %}
                            <div class="p-3">
                                <p class="text-gray-500 text-sm">No contact information available</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Order Status Summary -->
                    <div class="bg-white rounded-sm shadow-sm overflow-hidden mb-6 border-[1px] border-gray-300">
                        <div class="bg-secondary px-3 py-2 text-white font-medium flex items-center">
                            <i class="fas fa-clipboard-list mr-2"></i>
                            <span>My Orders</span>
                        </div>
                        <div class="p-4">
                            <div class="flex justify-between mb-3">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-secondary">{{ order_stats.processing_count or 0 }}</div>
                                    <div class="text-xs text-gray-600">Processing</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-secondary">{{ order_stats.shipped_count or 0 }}</div>
                                    <div class="text-xs text-gray-600">Shipped</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-secondary">{{ order_stats.completed_count or 0 }}</div>
                                    <div class="text-xs text-gray-600">Completed</div>
                                </div>
                            </div>
                            <div class="pt-3 border-t border-gray-100">
                                <a href="#tab-content-orders" class="text-secondary text-sm font-medium hover:underline flex items-center justify-center">
                                    Track Recent Order <i class="fas fa-truck ml-2"></i>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Vendor Rating & Reviews -->
                    <div class="bg-white rounded-sm shadow-sm overflow-hidden border-[1px] border-gray-300">
                        <div class="bg-secondary px-3 py-2 text-white font-medium flex items-center">
                            <i class="fas fa-star mr-2"></i>
                            <span>Vendor Rating</span>
                        </div>
                        <div class="p-4">
                            <div class="flex items-center justify-center mb-2">
                                <div class="text-3xl font-bold text-secondary mr-2">{{ rating or '4.7' }}</div>
                                <div class="flex flex-col">
                                    <div class="flex">
                                        {% for i in range(5) %}
                                            {% if i < (rating or 4) %}
                                                <i class="fas fa-star text-yellow-400"></i>
                                            {% elif i < (rating|float or 4.7) %}
                                                <i class="fas fa-star-half-alt text-yellow-400"></i>
                                            {% else %}
                                                <i class="far fa-star text-yellow-400"></i>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                    <div class="text-xs text-gray-600">Based on {{ vendor.reviews_count or 48 }} reviews</div>
                                </div>
                            </div>
                            <div class="space-y-2 mt-3">
                                {% for rating in rating_distribution or [{'stars': 5, 'count': 36, 'percentage': 75}, {'stars': 4, 'count': 7, 'percentage': 15}, {'stars': 3, 'count': 3, 'percentage': 5}] %}
                                    <div class="flex items-center text-xs">
                                        <span class="w-12">{{ rating.stars }} stars</span>
                                        <div class="flex-1 bg-gray-200 rounded-full h-2 mx-2">
                                            <div class="bg-secondary h-2 rounded-full" style="width: {{ rating.percentage }}%"></div>
                                        </div>
                                        <span>{{ rating.count }}</span>
                                    </div>
                                {% endfor %}
                            </div>
                            <div class="pt-3 mt-3 border-t border-gray-100 text-center">
                                <a href="#" class="text-secondary text-sm font-medium hover:underline">Write a Review</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Content Area -->
                <div class="w-full lg:col-span-3 md:col-span-2 col-span-1">
                    <!-- Vendor Profile Tab Content -->
                    <div id="tab-content-vendorProfile" data-tab-content="vendorProfile" class="vendor-tab-content w-full">
                        <!-- Vendor Header Section -->
                        <div class="relative bg-gradient-to-r from-secondary to-secondary/80 rounded-xl shadow-lg overflow-hidden mb-8 h-48 flex items-center">
                            <div class="absolute inset-0 bg-black/30"></div>
                            <div class="relative z-10 px-8 w-full">
                                <div class="flex flex-col md:flex-row items-center md:items-end justify-between">
                                    <div class="flex items-center mb-4 md:mb-0">
                                        <div class="bg-white p-2 rounded-lg shadow-xl mr-6 w-24 h-24 flex items-center justify-center">
                                            <img src="{{ url_for('static', filename=vendor.logo or 'images/profile.png') }}" class="max-w-full max-h-full object-contain" alt="{{ vendor.company_name }}">
                                        </div>
                                        <div>
                                            <h1 class="text-3xl font-bold text-white">{{ vendor.company_name }}</h1>
                                            <p class="text-white/90">{{ vendor.dealing_categories or 'Vendor' }}</p>
                                        </div>
                                    </div>
                                    <div class="bg-white/90 px-4 py-2 rounded-lg shadow">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-secondary font-medium">Vendor Rating:</span>
                                            <div class="flex">
                                                {% for i in range(5) %}
                                                    {% if i < (rating or 4) %}
                                                        <i class="fas fa-star text-yellow-400"></i>
                                                    {% elif i < (rating|float or 4.7) %}
                                                        <i class="fas fa-star-half-alt text-yellow-400"></i>
                                                    {% else %}
                                                        <i class="far fa-star text-yellow-400"></i>
                                                    {% endif %}
                                                {% endfor %}
                                                <span class="ml-1 text-gray-700">{{ rating or '4.7' }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    {% if current_user.is_authenticated %}
                                        <button class="bookmark-btn absolute top-3 right-3 p-2 rounded-full hover:bg-yellow-50 transition-colors"
                                                data-type="vendor"
                                                data-id="{{ vendor.id }}"
                                                title="Bookmark this vendor">
                                            <i class="far fa-bookmark text-gray-400 text-lg"></i>
                                        </button>
                                    {% else %}
                                        <a href="{{ url_for('auth.login') }}"
                                           class="absolute top-3 right-3 p-2 rounded-full bg-white/80 border border-gray-200 
                                                  hover:bg-primary hover:text-secondary hover:border-primary 
                                                  transition-all duration-300 shadow-sm z-10 group"
                                           title="Login to bookmark this profile">
                                            <i class="far fa-bookmark text-gray-400 text-lg"></i>
                                            <span class="absolute -top-1 -right-1 flex items-center justify-center w-4 h-4 
                                                          rounded-full bg-white border border-gray-300 shadow group-hover:bg-secondary">
                                                <i class="fas fa-lock text-[10px] text-gray-600 group-hover:text-white"></i>
                                            </span>
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Main Content Grid -->
                        <div class="grid md:grid-cols-4 gap-6">
                            <!-- Vendor Quick Info Sidebar -->
                            <div class="md:col-span-1 space-y-6">
                                <!-- Basic Info Card -->
                                <div class="bg-white rounded-lg shadow-md p-4 border-t-4 border-secondary">
                                    <h3 class="font-bold text-gray-700 mb-3 text-sm uppercase tracking-wider">Vendor Details</h3>
                                    <ul class="space-y-3 text-sm">
                                        {% if vendor.contact_person %}
                                        <li class="flex items-start">
                                            <div class="bg-secondary/10 p-1 rounded mr-2 mt-0.5">
                                                <i class="fas fa-user text-secondary text-xs"></i>
                                            </div>
                                            <span><strong>Contact:</strong> {{ vendor.contact_person }}</span>
                                        </li>
                                        {% endif %}
                                        {% if vendor.email %}
                                        <li class="flex items-start">
                                            <div class="bg-secondary/10 p-1 rounded mr-2 mt-0.5">
                                                <i class="fas fa-envelope text-secondary text-xs"></i>
                                            </div>
                                            <div class="flex-1 min-w-0">
                                                <span class="block truncate"><strong>Email:</strong> {{ vendor.email }}</span>
                                            </div>
                                        </li>
                                        {% endif %}
                                        {% if vendor.contact_phone %}
                                        <li class="flex items-start">
                                            <div class="bg-secondary/10 p-1 rounded mr-2 mt-0.5">
                                                <i class="fas fa-phone text-secondary text-xs"></i>
                                            </div>
                                            <span><strong>Phone:</strong> {{ vendor.contact_phone }}</span>
                                        </li>
                                        {% endif %}
                                        {% if vendor.gst %}
                                        <li class="flex items-start">
                                            <div class="bg-secondary/10 p-1 rounded mr-2 mt-0.5">
                                                <i class="fas fa-industry text-secondary text-xs"></i>
                                            </div>
                                            <span><strong>GST:</strong> {{ vendor.gst }}</span>
                                        </li>
                                        {% endif %}
                                        {% if not (vendor.contact_person or vendor.email or vendor.contact_phone or vendor.gst) %}
                                        <li class="text-gray-500">No details available</li>
                                        {% endif %}
                                    </ul>
                                </div>

                                <!-- Regional Contacts Card -->
                                <div class="bg-white rounded-lg shadow-md p-4 border-t-4 border-secondary">
                                    <h3 class="font-bold text-gray-700 mb-3 text-sm uppercase tracking-wider">Regional Contacts</h3>
                                    <div class="space-y-4">
                                        {% for contact in vendor.regional_contacts or [] %}
                                        <div class="border-l-2 border-secondary/30 pl-3">
                                            <h4 class="font-semibold text-sm">{{ contact.region }}</h4>
                                            <p class="text-xs text-gray-600">{{ contact.name }}<br>{{ contact.email }}<br>{{ contact.phone }}</p>
                                        </div>
                                        {% else %}
                                        <p class="text-gray-500 text-sm">No regional contacts available</p>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>

                            <!-- Main Vendor Content -->
                            <div class="md:col-span-3 space-y-6">
                                <!-- About Vendor Section -->
                                <div class="bg-white rounded-lg shadow-md p-6">
                                    <div class="flex items-center mb-4">
                                        <div class="w-1 h-8 bg-secondary mr-3"></div>
                                        <h2 class="text-xl font-bold text-gray-800">Company Profile</h2>
                                    </div>
                                    <div class="grid md:grid-cols-2 gap-6">
                                        <div>
                                            <p class="text-gray-700 mb-4">{{ vendor.overview or 'No overview provided.' }}</p>
                                            <div class="bg-secondary/10 p-3 rounded-lg border-l-4 border-secondary">
                                                <h3 class="font-semibold text-gray-800 mb-1">Key Strengths</h3>
                                                <ul class="list-disc list-inside text-sm text-gray-600 space-y-1">
                                                    {% for strength in vendor.strengths or ['Global supply chain network', 'Competitive bulk pricing', 'Flexible order fulfillment', 'Quality assurance guarantee'] %}
                                                    <li>{{ strength }}</li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="bg-gray-50 rounded-lg p-4">
                                            <h3 class="font-semibold text-gray-800 mb-3 flex items-center">
                                                <i class="fas fa-map-marker-alt text-secondary mr-2"></i>
                                                Distribution Centers
                                            </h3>
                                            <div class="grid grid-cols-2 gap-3 text-sm">
                                                {% for center in vendor.distribution_centers or ['Los Angeles, USA', 'Rotterdam, NL', 'Singapore', 'Dubai, UAE'] %}
                                                <div class="flex items-start">
                                                    <i class="fas fa-warehouse text-gray-400 mt-0.5 mr-2"></i>
                                                    <span>{{ center }}</span>
                                                </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Product Categories Section -->
                                {% if vendor.product_categories %}
                                <div class="bg-white rounded-lg shadow-md p-6">
                                    <div class="flex items-center mb-4">
                                        <div class="w-1 h-8 bg-secondary mr-3"></div>
                                        <h2 class="text-xl font-bold text-gray-800">Product Categories</h2>
                                    </div>
                                    <div class="grid md:grid-cols-3 gap-4">
                                        {% for category in vendor.product_categories.split(',') %}
                                        <div class="border rounded-lg p-3 hover:border-secondary transition-colors">
                                            <div class="flex items-center mb-2">
                                                <div class="bg-secondary/10 p-2 rounded-full mr-3">
                                                    <i class="fas fa-box text-secondary"></i>
                                                </div>
                                                <h3 class="font-semibold">{{ category.strip() }}</h3>
                                            </div>
                                            <p class="text-gray-600 text-xs">Available products in {{ category.strip() }}</p>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Special Offers Section -->
                                <div class="bg-white rounded-lg shadow-md p-6">
                                    <div class="flex items-center mb-4">
                                        <div class="w-1 h-8 bg-secondary mr-3"></div>
                                        <h2 class="text-xl font-bold text-gray-800">Current Offers</h2>
                                    </div>
                                    <div class="grid md:grid-cols-2 gap-6">
                                        {% for offer in vendor.offers or [{'title': 'Summer Season Special', 'description': '15% discount on all summer apparel and accessories. Minimum order $5,000.', 'status': 'Limited Time', 'valid_until': 'Aug 31, 2023'}, {'title': 'Bulk Purchase Program', 'description': 'Tiered pricing available for orders over $20,000. Free shipping on orders over $50,000.', 'status': 'Ongoing', 'discount': '5% to 20%'}] %}
                                        <div class="border border-secondary/20 rounded-lg p-4 bg-secondary/10">
                                            <div class="flex justify-between items-start mb-2">
                                                <h3 class="font-semibold text-secondary">{{ offer.title }}</h3>
                                                <span class="bg-secondary text-white text-xs px-2 py-1 rounded">{{ offer.status }}</span>
                                            </div>
                                            <p class="text-gray-700 text-sm mb-3">{{ offer.description }}</p>
                                            <div class="flex justify-between items-center text-sm">
                                                <div class="text-secondary">
                                                    {% if offer.valid_until %}
                                                    <i class="far fa-calendar-alt mr-1"></i>
                                                    <span>Valid until {{ offer.valid_until }}</span>
                                                    {% elif offer.discount %}
                                                    <i class="fas fa-percentage mr-1"></i>
                                                    <span>Discounts {{ offer.discount }}</span>
                                                    {% endif %}
                                                </div>
                                                <button class="text-secondary hover:text-secondary-dark font-medium">
                                                    Details <i class="fas fa-chevron-right ml-1 text-xs"></i>
                                                </button>
                                            </div>
                                        </div>
                                        {% else %}
                                        <p class="text-gray-500 col-span-2">No offers available</p>
                                        {% endfor %}
                                    </div>
                                </div>

                                <!-- Sponsorship Section -->
                                <div class="bg-white rounded-lg shadow-md p-6">
                                    <div class="flex items-center mb-4">
                                        <div class="w-1 h-8 bg-secondary mr-3"></div>
                                        <h2 class="text-xl font-bold text-gray-800">Sponsorship & Partnerships</h2>
                                    </div>
                                    <div class="grid md:grid-cols-2 gap-6">
                                        <div>
                                            <h3 class="font-semibold text-gray-800 mb-2">Sponsorship Opportunities</h3>
                                            <p class="text-gray-700 text-sm mb-4">{{ vendor.sponsorship_info or 'We support the business community through various sponsorship programs.' }}</p>
                                            <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
                                                {% for item in vendor.sponsorship_focus or ['Trade shows and industry events', 'Startup incubators and business competitions', 'Sustainable business initiatives', 'Local business associations'] %}
                                                <li>{{ item }}</li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                        <div class="bg-secondary/10 rounded-lg p-4 border border-secondary/20">
                                            <h3 class="font-semibold text-gray-800 mb-3">Sponsorship Inquiry</h3>
                                            <p class="text-gray-700 text-sm mb-4">{{ vendor.sponsorship_contact or 'Interested in discussing sponsorship opportunities? Our partnership team would be happy to explore possibilities.' }}</p>
                                            <button class="w-full md:w-auto px-4 py-2 bg-secondary text-white rounded-md hover:bg-secondary-dark transition-colors text-sm font-medium">
                                                Contact Partnership Team
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- My Messages Tab Content -->
                    <div id="tab-content-message" data-tab-content="message" class="vendor-tab-content w-full hidden">
                        <!-- Messages Hero Section -->
                        <div class="relative bg-gradient-to-r from-secondary to-secondary/80 rounded-xl shadow-lg overflow-hidden mb-8 h-48 flex items-end">
                            <div class="absolute inset-0 bg-black/40"></div>
                            <div class="relative z-10 px-8 pb-8 w-full">
                                <h1 class="text-3xl font-bold text-white mb-2">My Messages</h1>
                                <p class="text-white/90 max-w-2xl">{{ vendor.messages_description or 'Stay connected with your business communications' }}</p>
                                {% if current_user.is_authenticated %}
                                    <button class="bookmark-btn absolute top-3 right-3 p-2 rounded-full hover:bg-yellow-50 transition-colors"
                                            data-type="messages_section"
                                            data-id="{{ vendor.id }}"
                                            title="Bookmark this messages section">
                                        <i class="far fa-bookmark text-gray-400 text-lg"></i>
                                    </button>
                                {% else %}
                                    <a href="{{ url_for('auth.login') }}"
                                       class="absolute top-3 right-3 p-2 rounded-full bg-white/80 border border-gray-200 
                                              hover:bg-primary hover:text-secondary hover:border-primary 
                                              transition-all duration-300 shadow-sm z-10 group"
                                       title="Login to bookmark this messages section">
                                        <i class="far fa-bookmark text-gray-400 text-lg"></i>
                                        <span class="absolute -top-1 -right-1 flex items-center justify-center w-4 h-4 
                                                      rounded-full bg-white border border-gray-300 shadow group-hover:bg-secondary">
                                            <i class="fas fa-lock text-[10px] text-gray-600 group-hover:text-white"></i>
                                        </span>
                                    </a>
                                {% endif %}
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-md p-6">
                            <div class="flex items-center justify-between mb-6">
                                <div class="flex items-center">
                                    <div class="w-1 h-8 bg-secondary mr-3"></div>
                                    <h2 class="text-xl font-bold text-gray-800">Messages</h2>
                                </div>
                                <button class="px-4 py-2 bg-secondary text-white rounded-md hover:bg-secondary-dark transition-colors text-sm font-medium flex items-center">
                                    <i class="fas fa-plus mr-2"></i> New Message
                                </button>
                            </div>

                            <!-- Message Navigation -->
                            <div class="flex border-b border-gray-200 mb-6">
                                <button class="px-4 py-2 font-medium text-sm border-b-2 border-secondary text-secondary">Inbox ({{ vendor.messages|selectattr('status', 'equalto', 'new')|list|length or 3 }})</button>
                                <button class="px-4 py-2 font-medium text-sm text-gray-500 hover:text-gray-700">Sent</button>
                                <button class="px-4 py-2 font-medium text-sm text-gray-500 hover:text-gray-700">Archived</button>
                            </div>

                            <!-- Messages List -->
                            <div class="space-y-4">
                                {% for message in vendor.messages or [{'id': 1, 'title': 'Order #24567 Inquiry', 'content': 'Regarding delayed shipment of summer collection', 'sender': 'John Smith', 'date': '2023-06-15', 'status': 'New', 'icon': 'fas fa-envelope', 'icon_color': 'indigo-600'}, {'id': 2, 'title': 'Bulk Order Confirmation', 'content': 'Your PO #7890 has been processed', 'sender': 'System', 'date': '2023-06-10', 'status': 'Completed', 'icon': 'fas fa-check-circle', 'icon_color': 'green-600'}, {'id': 3, 'title': 'Payment Reminder', 'content': 'Invoice #4567 due in 3 days', 'sender': 'Finance Team', 'date': '2023-06-05', 'status': 'Urgent', 'icon': 'fas fa-exclamation-circle', 'icon_color': 'orange-600'}] %}
                                <div class="border border-gray-200 rounded-lg p-4 hover:border-secondary transition-colors {{ 'bg-gray-50' if message.status == 'Completed' else '' }} relative">
                                    {% if current_user.is_authenticated %}
                                        <button class="bookmark-btn absolute top-3 right-3 p-1.5 rounded-full hover:bg-yellow-50 transition-colors"
                                                data-type="message"
                                                data-id="{{ message.id }}"
                                                title="Bookmark this message">
                                            <i class="far fa-bookmark text-gray-400 hover:text-yellow-500 text-lg"></i>
                                        </button>
                                    {% else %}
                                        <a href="{{ url_for('auth.login') }}"
                                           class="absolute top-3 right-3 p-2 rounded-full bg-white/80 border border-gray-200 
                                                  hover:bg-primary hover:text-secondary hover:border-primary 
                                                  transition-all duration-300 shadow-sm z-10 group"
                                           title="Login to bookmark this message">
                                            <i class="far fa-bookmark text-gray-400 text-lg"></i>
                                            <span class="absolute -top-1 -right-1 flex items-center justify-center w-4 h-4 
                                                          rounded-full bg-white border border-gray-300 shadow group-hover:bg-secondary">
                                                <i class="fas fa-lock text-[10px] text-gray-600 group-hover:text-white"></i>
                                            </span>
                                        </a>
                                    {% endif %}
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-start">
                                            <div class="bg-{{ message.icon_color }}-100 p-2 rounded-full mr-3 mt-1">
                                                <i class="{{ message.icon }} text-{{ message.icon_color }}"></i>
                                            </div>
                                            <div>
                                                <h3 class="font-semibold text-gray-800">{{ message.title }}</h3>
                                                <p class="text-sm text-gray-600">{{ message.content }}</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs text-gray-500 block">{{ message.date }}</span>
                                            <span class="inline-block mt-1 bg-{{ message.icon_color }}-100 text-{{ message.icon_color }} text-xs px-2 py-0.5 rounded-full">{{ message.status }}</span>
                                        </div>
                                    </div>
                                </div>
                                {% else %}
                                <p class="text-gray-500">No messages available</p>
                                {% endfor %}
                            </div>

                            <!-- Message View Area (hidden by default, appears when message selected) -->
                            <div class="hidden mt-6 border border-gray-200 rounded-lg p-6">
                                <div class="flex justify-between items-center mb-4 pb-4 border-b border-gray-200">
                                    <div>
                                        <h3 class="font-bold text-lg">{{ vendor.messages[0].title if vendor.messages else 'Order #24567 Inquiry' }}</h3>
                                        <p class="text-sm text-gray-600">From: {{ vendor.messages[0].sender if vendor.messages else 'John Smith (Global Suppliers Ltd.)' }}</p>
                                    </div>
                                    <span class="text-sm text-gray-500">{{ vendor.messages[0].date if vendor.messages else 'Jun 15, 2023, 10:24 AM' }}</span>
                                </div>
                                <div class="mb-6">
                                    <p class="text-gray-700 mb-4">{{ vendor.messages[0].full_content if vendor.messages else 'Dear Purchasing Team,<br><br>I\'m following up on our summer collection order (#24567) which was scheduled for delivery on June 10th. Our tracking system shows the shipment hasn\'t left your facility yet. Could you please provide an update on the status and expected delivery date?<br><br>We have retail promotions tied to this inventory and need to adjust our marketing if there will be delays.' }}</p>
                                    <div class="bg-gray-100 p-3 rounded-lg text-sm">
                                        <p class="font-medium mb-1">Attachments:</p>
                                        <a href="#" class="text-secondary hover:underline flex items-center">
                                            <i class="fas fa-file-pdf mr-2"></i> {{ vendor.messages[0].attachment if vendor.messages else 'PO_24567.pdf' }}
                                        </a>
                                    </div>
                                </div>
                                <div class="border-t border-gray-200 pt-4">
                                    <h4 class="font-medium mb-3">Reply to Message</h4>
                                    <textarea class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-secondary focus:border-secondary mb-3" rows="4" placeholder="Type your reply here..."></textarea>
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <button class="p-2 text-gray-500 hover:text-gray-700 mr-2">
                                                <i class="fas fa-paperclip"></i>
                                            </button>
                                            <button class="p-2 text-gray-500 hover:text-gray-700">
                                                <i class="fas fa-image"></i>
                                            </button>
                                        </div>
                                        <button class="px-4 py-2 bg-secondary text-white rounded-md hover:bg-secondary-dark transition-colors">
                                            Send Reply
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Pagination -->
                            <div class="mt-6 flex justify-center">
                                <nav class="inline-flex rounded-md shadow">
                                    <a href="#" class="px-3 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                        <i class="fas fa-chevron-left"></i>
                                    </a>
                                    <a href="#" class="px-3 py-2 border-t border-b border-gray-300 bg-white text-sm font-medium text-secondary hover:bg-gray-50">1</a>
                                    <a href="#" class="px-3 py-2 border-t border-b border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">2</a>
                                    <a href="#" class="px-3 py-2 border-t border-b border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">3</a>
                                    <a href="#" class="px-3 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                        <i class="fas fa-chevron-right"></i>
                                    </a>
                                </nav>
                            </div>
                        </div>
                    </div>

                    <!-- My Orders Tab Content -->
                    <div id="tab-content-orders" data-tab-content="orders" class="vendor-tab-content w-full hidden">
                        <!-- Orders Hero Section -->
                        <div class="relative bg-gradient-to-r from-secondary to-secondary/80 rounded-xl shadow-lg overflow-hidden mb-8 h-48 flex items-end">
                            <div class="absolute inset-0 bg-black/40"></div>
                            <div class="relative z-10 px-8 pb-8 w-full">
                                <h1 class="text-3xl font-bold text-white mb-2">My Orders</h1>
                                <p class="text-white/90 max-w-2xl">{{ orders_description or 'Manage and track your vendor orders' }}</p>
                                {% if current_user.is_authenticated %}
                                    <button class="bookmark-btn absolute top-3 right-3 p-2 rounded-full hover:bg-yellow-50 transition-colors"
                                            data-type="orders_section"
                                            data-id="{{ vendor.id }}"
                                            title="Bookmark this orders section">
                                        <i class="far fa-bookmark text-gray-400 text-lg"></i>
                                    </button>
                                {% else %}
                                    <a href="{{ url_for('auth.login') }}"
                                       class="absolute top-3 right-3 p-2 rounded-full bg-white/80 border border-gray-200 
                                              hover:bg-primary hover:text-secondary hover:border-primary 
                                              transition-all duration-300 shadow-sm z-10 group"
                                       title="Login to bookmark this orders section">
                                        <i class="far fa-bookmark text-gray-400 text-lg"></i>
                                        <span class="absolute -top-1 -right-1 flex items-center justify-center w-4 h-4 
                                                      rounded-full bg-white border border-gray-300 shadow group-hover:bg-secondary">
                                            <i class="fas fa-lock text-[10px] text-gray-600 group-hover:text-white"></i>
                                        </span>
                                    </a>
                                {% endif %}
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-md p-6">
                            <div class="flex items-center mb-6">
                                <div class="w-1 h-8 bg-secondary mr-3"></div>
                                <h2 class="text-xl font-bold text-gray-800">Order History</h2>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order ID</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        {% for order in vendor.orders or [{'id': '24567', 'date': '2023-06-15', 'total': '$12,450', 'status': 'Processing'}, {'id': '7890', 'date': '2023-06-10', 'total': '$25,000', 'status': 'Shipped'}, {'id': '4567', 'date': '2023-06-05', 'total': '$8,750', 'status': 'Completed'}] %}
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ order.id }}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ order.date }}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ order.total }}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <span class="inline-block bg-{{ 'secondary' if order.status == 'Processing' else 'green-600' if order.status == 'Shipped' else 'gray-600' }}-100 text-{{ 'secondary' if order.status == 'Processing' else 'green-800' if order.status == 'Shipped' else 'gray-800' }} text-xs px-2 py-0.5 rounded-full">{{ order.status }}</span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm">
                                                <a href="#" class="text-secondary hover:underline">View</a>
                                            </td>
                                        </tr>
                                        {% else %}
                                        <tr>
                                            <td colspan="5" class="px-6 py-4 text-sm text-gray-500 text-center">No orders available</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-6 flex justify-center">
                                <nav class="inline-flex rounded-md shadow">
                                    <a href="#" class="px-3 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                        <i class="fas fa-chevron-left"></i>
                                    </a>
                                    <a href="#" class="px-3 py-2 border-t border-b border-gray-300 bg-white text-sm font-medium text-secondary hover:bg-gray-50">1</a>
                                    <a href="#" class="px-3 py-2 border-t border-b border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">2</a>
                                    <a href="#" class="px-3 py-2 border-t border-b border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">3</a>
                                    <a href="#" class="px-3 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                        <i class="fas fa-chevron-right"></i>
                                    </a>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab functionality
    const tabContents = document.querySelectorAll('.vendor-tab-content');
    
    // Show the first tab content by default
    if (tabContents.length > 0) {
        tabContents[0].classList.remove('hidden');
    }

    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            
            const targetId = this.getAttribute('href');
            const targetElement = document.querySelector(targetId);
            
            if (targetElement) {
                // Hide all tab contents first
                document.querySelectorAll('.vendor-tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                
                // Show the target tab content
                targetElement.classList.remove('hidden');
                
                // Scroll to the target
                targetElement.scrollIntoView({
                    behavior: 'smooth'
                });
            }
        });
    });

    // Check bookmark status for all items
    function checkAllBookmarkStatuses() {
        {% if current_user.is_authenticated %}
            document.querySelectorAll('.bookmark-btn').forEach(button => {
                const bookmarkType = button.dataset.type;
                const itemId = button.dataset.id;
                
                fetch(`/bookmark/status/${bookmarkType}/${itemId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.bookmarked) {
                            button.innerHTML = '<i class="fas fa-bookmark text-yellow-500 text-lg"></i>';
                            button.classList.add('bookmarked');
                        } else {
                            button.innerHTML = '<i class="far fa-bookmark text-gray-400 hover:text-yellow-500 text-lg"></i>';
                            button.classList.remove('bookmarked');
                        }
                    })
                    .catch(error => {
                        console.error('Error checking bookmark status:', error);
                    });
            });
        {% endif %}
    }

    // Check all bookmark statuses on page load
    checkAllBookmarkStatuses();

    // Bookmark toggle functionality
    document.querySelectorAll('.bookmark-btn').forEach(button => {
        button.addEventListener('click', function() {
            const bookmarkType = this.dataset.type;
            const itemId = this.dataset.id;
            
            fetch(`/bookmark/${bookmarkType}/${itemId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    if (data.bookmarked) {
                        this.innerHTML = '<i class="fas fa-bookmark text-yellow-500 text-lg"></i>';
                        this.classList.add('bookmarked');
                        showNotification('Bookmark added!', 'success');
                    } else {
                        this.innerHTML = '<i class="far fa-bookmark text-gray-400 hover:text-yellow-500 text-lg"></i>';
                        this.classList.remove('bookmarked');
                        showNotification('Bookmark removed', 'info');
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Error updating bookmark', 'error');
            });
        });
    });
    
    // Notification function
    function showNotification(message, type) {
        const existingNotification = document.querySelector('.fixed.notification');
        if (existingNotification) {
            document.body.removeChild(existingNotification);
        }
        
        const notification = document.createElement('div');
        notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 transition-transform transform translate-x-full notification ${type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500'} text-white`;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.classList.remove('translate-x-full');
            notification.classList.add('translate-x-0');
        }, 10);
        
        setTimeout(() => {
            notification.classList.remove('translate-x-0');
            notification.classList.add('translate-x-full');
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 300);
        }, 3000);
    }
});
</script>

{% endblock %}